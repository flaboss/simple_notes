# Estilo personalizado para os campos de texto
<ModernInput@TextInput>:
    background_normal: ''
    background_active: ''
    background_disabled_normal: ''
    background_color: 0, 0, 0, 0  # Remove o fundo padrão
    padding: [dp(15), dp(15)]
    font_size: '16sp'
    cursor_color: app.colors['accent']
    foreground_color: app.colors['text']
    disabled_foreground_color: app.colors['text']
    readonly_foreground_color: app.colors['text']
    use_bubble: True
    hint_text_color: app.colors['text_sec']
    canvas.before:
        Color:
            rgba: app.colors['surface']  # Fundo dinâmico
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10),]
        Color:
            rgba: app.colors['accent'] if self.focus else app.colors['border']
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(10))
            width: dp(1)

# Estilização de um botão de nota personalizado
<NoteItem@Button>:
    background_normal: ''
    background_color: 0, 0, 0, 0  # Torna o fundo do botão transparente
    canvas.before:
        Color:
            rgba: app.colors['surface']  # Fundo do Card
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10),]  # Bordas arredondadas
    
    # Alinhamento à ESQUERDA
    text_size: self.width - dp(40), None  # Define largura do texto menor que o botão
    halign: 'left'
    valign: 'middle'
    padding: [dp(20), dp(10)]
    color: app.colors['text']

<ConfirmPopup>:
    orientation: 'vertical'
    padding: dp(20)
    spacing: dp(20)
    
    Label:
        text: "Tem certeza que deseja excluir esta nota? Esta ação não pode ser desfeita."
        text_size: self.width, None
        halign: 'center'
        font_size: '16sp'
        color: app.colors['text']

    BoxLayout:
        size_hint_y: None
        height: dp(50)
        spacing: dp(10)
        
        Button:
            text: "Cancelar"
            on_release: root.popup.dismiss() # Fecha o alerta
            
        Button:
            text: "Excluir"
            background_color: app.colors['danger']
            on_release: 
                root.on_confirm()
                #root.popup.dismiss()

<NoteListScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)
        canvas.before:
            Color:
                rgba: app.colors['bg']  # Fundo dinâmico
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            size_hint_y: None
            height: dp(60)
            
            Label:
                text: "Minhas Notas"
                font_size: '28sp'
                bold: True
                color: app.colors['text']
                halign: 'left'
                text_size: self.size
                valign: 'middle'

            Button:
                text: "Conta"
                size_hint_x: None
                width: dp(80)
                background_normal: ''
                background_color: app.colors['accent']
                color: [1, 1, 1, 1]
                bold: True
                on_release: root.manager.current = 'login'
                canvas.before:
                    Color:
                        rgba: app.colors['accent']
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(5),]

        ModernInput:
            id: search_input
            hint_text: "Pesquisar notas"
            size_hint_y: None
            height: dp(50)
            multiline: False
            on_text: root.filter_notes(self.text)

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            GridLayout:
                id: notes_box
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(12)
                padding: dp(10)
                row_default_height: dp(90)

        # Botão flutuante minimalista
        Button:
            text: "+"
            font_size: '32sp' # increases size but keeping proportions
            bold: True
            halign: 'center'
            valign: 'middle'
            size_hint: None, None
            size: dp(56), dp(56)
            pos_hint: {'right': 1}
            background_normal: ''
            background_color: 0,0,0,0 # deixa o botao padrao transparente
            on_release: root.manager.current = 'create'
            #cria o botao redondo
            canvas.before:
                Color:
                    rgba: app.colors['accent'] # Azul moderno dinâmico
                Ellipse:
                    pos: self.pos
                    size: self.size

<LoginScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(15)
        canvas.before:
            Color:
                rgba: app.colors['bg']
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "Conta & Sincronização"
            font_size: '24sp'
            bold: True
            color: app.colors['text']
            size_hint_y: None
            height: dp(60)

        Label:
            text: "Logado como: " + root.user_email if root.is_logged_in else "Não logado"
            color: app.colors['text_sec']
            size_hint_y: None
            height: dp(30)
            font_size: '16sp'

        ModernInput:
            id: email_input
            hint_text: "Email"
            size_hint_y: None
            height: dp(55)
            multiline: False
            disabled: root.is_logged_in

        ModernInput:
            id: password_input
            hint_text: "Senha"
            password: True
            size_hint_y: None
            height: dp(55)
            multiline: False
            disabled: root.is_logged_in

        Label:
            text: root.status_message
            color: (0, 0.5, 0, 1) if "sucesso" in root.status_message.lower() else (1, 0, 0, 1)
            size_hint_y: None
            height: dp(30)
            font_size: '14sp'

        BoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(15)
            
            Button:
                text: "Entrar"
                background_color: app.colors['accent']
                on_release: root.do_login(email_input.text, password_input.text)
                disabled: root.is_logged_in
                opacity: 0 if root.is_logged_in else 1
            
            Button:
                text: "Criar Conta"
                background_color: 0.2, 0.6, 0.2, 1
                on_release: root.do_register(email_input.text, password_input.text)
                disabled: root.is_logged_in
                opacity: 0 if root.is_logged_in else 1

        Button:
            text: "Sair da Conta"
            size_hint_y: None
            height: dp(50) if root.is_logged_in else dp(0)
            opacity: 1 if root.is_logged_in else 0
            disabled: not root.is_logged_in
            background_color: app.colors['danger']
            on_release: root.do_logout()

        Button:
            text: "Trocar para Tema " + ("Escuro" if app.current_theme == "light" else "Claro")
            size_hint_y: None
            height: dp(50)
            background_color: 0.3, 0.3, 0.3, 1
            on_release: app.toggle_theme()

        Button:
            text: "Voltar"
            size_hint_y: None
            height: dp(50)
            background_color: 0.5, 0.5, 0.5, 1
            on_release: root.go_back()

        Widget: # Spacer

<CreateNoteScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(15)
        canvas.before:
            Color:
                rgba: app.colors['bg']  # Mesmo fundo da lista
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "Nova Nota"
            font_size: '24sp'
            bold: True
            color: app.colors['text']
            size_hint_y: None
            height: dp(60)
            halign: 'left'
            text_size: self.size

        ModernInput:
            id: note_title
            hint_text: "Título"
            size_hint_y: None
            height: dp(55)
            multiline: False

        ModernInput:
            id: note_content
            hint_text: "Conteúdo da nota..."
            # Ocupa o espaço restante

        BoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(15)
            
            Button:
                text: "Cancelar"
                on_release: root.manager.current = 'list'
            
            Button:
                text: "Salvar"
                background_color: app.colors['accent']
                on_release: 
                    root.save_note(note_title.text, note_content.text)
                    note_title.text = ""
                    note_content.text = ""

<ViewNoteScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(15)
        canvas.before:
            Color:
                rgba: app.colors['bg']
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "Editar Nota"
            font_size: '24sp'
            bold: True
            color: app.colors['text']
            size_hint_y: None
            height: dp(60)
            halign: 'left'
            text_size: self.size

        ModernInput:
            id: title_input
            size_hint_y: None
            height: dp(55)
            multiline: False

        ModernInput:
            id: content_input

        BoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            Button:
                text: "Excluir"
                color: [1, 1, 1, 1]
                background_color: app.colors['danger']
                on_release: root.show_delete_confirmation()

            Button:
                text: "Voltar"
                on_release:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'list'

            Button:
                text: "Atualizar"
                background_color: app.colors['accent']
                on_release: root.save_changes()
